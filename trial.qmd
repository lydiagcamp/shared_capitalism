---
title: "Hello, Quarto"
format: html
---
library(tidyverse)
library(plotly)


setwd("~/Desktop/MA UC3M/TFM/ESOP/Form 5500")
summary_df <- read_csv("aggregate_data.csv")


# Select only ESOP and profit_sharing
summary_long <- summary_df %>%
  select(year, ESOP, profit_sharing)

# Create a scaling factor so profit_sharing fits on the same plot
scale_factor <- max(summary_long$ESOP, na.rm = TRUE) / max(summary_long$profit_sharing, na.rm = TRUE)

p <- ggplot(summary_long, aes(x = year)) +
  # ESOP on primary y-axis
  geom_line(aes(y = ESOP, color = "ESOP"), size = 1.2) +
  geom_point(aes(y = ESOP, color = "ESOP"), size = 3) +
  # profit_sharing on secondary y-axis (scaled)
  geom_line(aes(y = profit_sharing * scale_factor, color = "Profit Sharing"), size = 1.2, linetype = "dashed") +
  geom_point(aes(y = profit_sharing * scale_factor, color = "Profit Sharing"), size = 3, shape = 17) +
  scale_y_continuous(
    name = "Number of ESOP Firms",
    sec.axis = sec_axis(~./scale_factor, name = "Number of Profit Sharing Firms")
  ) +
  scale_color_manual(values = c("ESOP" = "#1b9e77", "Profit Sharing" = "#d95f02")) +
  labs(
    title = "Counts of ESOP and Profit Sharing Over Time",
    x = "Year",
    color = "Variable"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "top",
    plot.title = element_text(face = "bold", size = 16),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

ggplotly(p)
